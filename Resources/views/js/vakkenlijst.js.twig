$(document).ready(function(){
	$('#faculties').hide();
	$('#levels').hide();
	$('#studies').hide();
	$('#programs').hide();
	$('#stages').hide();
	$('#courses').hide();

	$.getJSON('{{ path('dellaert_kul_education_api_list_faculties_by_id_title', {'_locale': app.request.locale}) }}', function(data){
		var len = data.length;
		if( len == 0 ) {
			var html = '<option value="-1">{% trans %}no.faculty{% endtrans %}</option>'
		} else {
			var html = '<option value="-1">{% trans %}choose.faculty{% endtrans %}</option>';
		}
		for( var i=0; i < len; i++ ){
			html += '<option value="' + data[i].id + '">' + data[i].title + '</option>';
		}
		$('#faculties').html(html);
	});
	$('#faculties').show();

	$('#faculties').change(function(){
		$('#courses').hide();
		$('#courses').html('');
		$('#stages').hide();
		$('#stages').html('<option value="-1">{% trans %}patience{% endtrans %}</option>');
		$('#programs').hide();
		$('#programs').html('<option value="-1">{% trans %}patience{% endtrans %}</option>');
		$('#studies').hide();
		$('#studies').html('<option value="-1">{% trans %}patience{% endtrans %}</option>');

		if( $(this).val() != -1 ) {
			$.getJSON('{{ path('dellaert_kul_education_api_list_levels_by_id_title_noid', {'_locale': app.request.locale}) }}/' + $(this).val(), function(data) {
				var len = data.length;
				if( len == 0 ) {
					var html = '<option value="-1">{% trans %}no.level{% endtrans %}</option>'
				} else {
					var html = '<option value="-1">{% trans %}choose.level{% endtrans %}</option>';
				}
				for( var i=0; i < len; i++ ){
					html += '<option value="' + data[i].id + '">' + data[i].title + '</option>';
				}
				$('#levels').html(html);
			});
			$('#levels').show();
		} else {
			$('#levels').hide();
			$('#levels').html('<option value="-1">{% trans %}patience{% endtrans %}</option>');
		}
	});

	$('#levels').change(function(){
		$('#courses').hide();
		$('#courses').html('');
		$('#stages').hide();
		$('#stages').html('<option value="-1">{% trans %}patience{% endtrans %}</option>');
		$('#programs').hide();
		$('#programs').html('<option value="-1">{% trans %}patience{% endtrans %}</option>');

		if( $(this).val() != -1 ) {
			$.getJSON('{{ path('dellaert_kul_education_api_list_studies_by_id_title_noid', {'_locale': app.request.locale}) }}/' + $('#faculties').val() + '/' + $(this).val(), function(data) {
				var len = data.length;
				if( len == 0 ) {
					var html = '<option value="-1">{% trans %}no.study{% endtrans %}</option>'
				} else {
					var html = '<option value="-1">{% trans %}choose.study{% endtrans %}</option>';
				}
				for( var i=0; i < len; i++ ){
					html += '<option value="' + data[i].id + '">' + data[i].title + '</option>';
				}
				$('#studies').html(html);
			});
			$('#studies').show();
		} else {
			$('#studies').hide();
			$('#studies').html('<option value="-1">{% trans %}patience{% endtrans %}</option>');
		}
	});

	$('#studies').change(function(){
		$('#courses').hide();
		$('#courses').html('');
		$('#stages').hide();
		$('#stages').html('<option value="-1">{% trans %}patience{% endtrans %}</option>');

		if( $(this).val() != -1 ) {
			$.getJSON('{{ path('dellaert_kul_education_api_list_programs_by_id_title_noid', {'_locale': app.request.locale}) }}/' + $(this).val(), function(data) {
				var len = data.length;
				if( len == 0 ) {
					var html = '<option value="-1">{% trans %}no.program{% endtrans %}</option>'
				} else {
					var html = '<option value="-1">{% trans %}choose.program{% endtrans %}</option>';
				}
				for( var i=0; i < len; i++ ){
					html += '<option value="' + data[i].id + '">' + data[i].title + ' (' + data[i].studypoints + ' {% trans %}studypoints{% endtrans %})</option>';
				}
				$('#programs').html(html);
			});
			$('#programs').show();
		} else {
			$('#programs').hide();
			$('#programs').html('<option value="-1">{% trans %}patience{% endtrans %}</option>');
		}
	});

	$('#programs').change(function(){
		$('#courses').hide();
		$('#courses').html('');

		if( $(this).val() != -1 ) {
			$.getJSON('{{ path('dellaert_kul_education_api_list_stages_by_id_title_noid', {'_locale': app.request.locale}) }}/' + $(this).val(), function(data) {
				var len = data.length;
				if( len == 0 ) {
					var html = '<option value="-1">{% trans %}no.stage{% endtrans %}</option>'
				} else {
					var html = '<option value="-1">{% trans %}choose.stage{% endtrans %}</option>';
				}
				for( var i=0; i < len; i++ ){
					html += '<option value="' + data[i].id + '">{% trans %}stage{% endtrans %} ' + data[i].id + '</option>';
				}
				$('#stages').html(html);
			});
			$('#stages').show();
		} else {
			$('#stages').hide();
			$('#stages').html('<option value="-1">{% trans %}patience{% endtrans %}</option>');
		}
	});

	$('#stages').change(function(){				
		if( $(this).val() != -1 ) {
			$.getJSON('{{ path('dellaert_kul_education_api_list_courses_in_level_noids', {'_locale': app.request.locale}) }}/' + $('#programs').val() + '/' + $(this).val(), function(data) {
				var html = '';

				var len = data.length;

				if( len > 0 ) {
					html += '<b>{% trans %}courses{% endtrans %}</b><br />'
						+'<table><tr><th><b>{% trans %}course.id{% endtrans %}</b></th>'
						+'<th><b>{% trans %}course.title{% endtrans %}</b></th>'
						+'<th><b>{% trans %}course.period{% endtrans %}</b></th>'
						+'<th><b>{% trans %}course.mandatory{% endtrans %}</b></th>'
						+'<th><b>{% trans %}course.studypoints{% endtrans %}</b></th>'
						+'<th><b>{% trans %}course.teachers{% endtrans %}</b></th></tr>';

					for( var i=0; i < len; i++ ) {
						html += '<tr><td>'+data[i].course_id+'</td>'
							+'<td>'+data[i].title+'</td>'
							+'<td>'+data[i].period+'</td>'
							+'<td>'+data[i].mandatory+'</td>'
							+'<td>'+data[i].studypoints+'</td>'
							+'<td>';
						lenteachers = data[i].teachers.length;
						for( var j=0; j<lenteachers; j++ ) {
							html += data[i].teachers[j].name;
							if( j < lenteachers-1 ) {
								html += '; ';
							}
						}
						html += '</td></tr>';
					}

					html += '</table><br />';
				}

				if( html == '' ) {
					html = '{% trans %}no.course{% endtrans %}';
				}

				$('#courses').html(html);


			});
			$('#courses').show();
		} else {
			$('#courses').hide();
			$('#courses').html('');
		}
	});

    $('.show_hide').click(function(){
    	if( $(this).next('.slidingDiv').hasClass('expanded') ) {
    		$(this).next('.slidingDiv').slideUp(200);
    		$(this).next('.slidingDiv').removeClass('expanded');
    		$(this).next('.slidingDiv').addClass('closed');
    	} else {
    		$(this).next('.slidingDiv').slideDown(200);
    		$(this).next('.slidingDiv').removeClass('closed');
    		$(this).next('.slidingDiv').addClass('expanded');
    	}
    });

    $('.expand_collapse_all').click(function(){
    	if( $(this).hasClass('expanded_all') ) {
    		$('.slidingDiv').slideUp(200);
    		$('.slidingDiv').removeClass('expanded');
    		$('.slidingDiv').addClass('closed');
    		$(this).removeClass('expanded_all');
    		$(this).addClass('closed_all');
    	} else {
    		$('.slidingDiv').slideDown(200);
    		$('.slidingDiv').removeClass('closed');
    		$('.slidingDiv').addClass('expanded');
    		$(this).removeClass('closed_all');
    		$(this).addClass('expanded_all');
    	}
    });
});